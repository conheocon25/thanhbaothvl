<!DOCTYPE html>
<html lang="en">
	<head>
		<span metal:use-macro="mApplication.xhtml/IncludeMETA"/>
		<span metal:use-macro="mApplication.xhtml/IncludeCSS"/>
		<span metal:use-macro="mApplication.xhtml/IncludeJS"/>		
	</head>
	<body>		
		<div class="container-fluid">
			<span metal:use-macro="mApplication.xhtml/Header"/>
			<div metal:use-macro="mApplication.xhtml/Menu"/>
			<div id="content">
				<div metal:use-macro="mApplication.xhtml/ContentHeader"/>
				<div metal:use-macro="mApplication.xhtml/LocationBar"/>
				<div class="container-fluid">
					<div class="row">
						<div class="col-12">							
							<div align="center" class="well" style="hight:50%;font-size:18pt;padding-top:-10px;">
									<label id="IdUser" tal:attributes="alt User/getId" align="center" tal:content="User/getNote" ></label>
									Điểm CM: <b style="color:red;" id="NTotal" tal:content="php:NTotal->formatCurrency()"/>							
									- Điểm ABC: <b style="color:red;" id="NTotalABC" tal:content="php:NTotalABC->formatCurrency()"/>
									 - <a align="center" class="brand" data-toggle="modal" href="#DialogChangeTime" > <i class="glyphicon glyphicon-time" style="margin-top:-5px;margin-right:5px;"/> Tháng <span tal:content="php: @\MVC\Base\SessionRegistry::instance()->getCurrentMonth()"/> Năm <span tal:content="php: @\MVC\Base\SessionRegistry::instance()->getCurrentYear()"/></a>
							</div>				
							<div class="form-horizontal">
								<div style="color:white;">
									<label class="control-label">Tên Chương trình</label>
									<div class="controls">
										<select id="IdCategory" name="IdCategory" >
											<option tal:repeat="CategoryPrograme CategoryProgrameAll" tal:attributes="value CategoryPrograme/getId" >
												<span  tal:content="CategoryPrograme/getName"/>
											</option>
										</select>
									</div>									
									<label class="control-label">Ngày làm</label>									
									<div class='controls'>
										<input type='text' style="width:10%" class="form-control input-small" name="DateStart"  id='DateStart'/>
									</div>									
									<label class="control-label">Số lượng</label>
									<div class="controls">										
										<select id="Count" name="Count">
											<option value = "1" >
												<span>1 Lần/ngày</span>
											</option>
											<option value = "2" >
												<span>2 Lần/ngày</span>
											</option>
											<option value = "3" >
												<span>3 Lần/ngày</span>
											</option>
											<option value = "4" >
												<span>4 Lần/ngày</span>
											</option>
											<option value = "5" >
												<span>5 Lần/ngày</span>
											</option>
										</select>
									</div>								
									<label class="control-label">Nội dung</label>
									<div class="controls">
										<textarea style="width:50%;" id="Content" name="Content" />
									</div>	
									<div class="control-group">
										<div class="controls">
											<button id="BtnAddReward" class="btn btn-primary btn-ins" value="submit-value">Thêm mới</button>
										</div>
									</div>
								</div>														
							</div>	
							<div id="RewardLoad" />							
						</div>
					</div>
				</div>
			</div>			
		</div>
		<span metal:use-macro="mApplication.xhtml/Footer"/>		
		<span metal:use-macro="mDialog.xhtml/DialogDelSelected"/>
		<span metal:use-macro="mApplication.xhtml/DialogChangeTime"/>
					<div id="DialogUpdateReward" class="modal fade">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<h3><i class="glyphicons-fast_food modal-icon"/>CẬP NHẬT THÔNG TIN</h3>
								</div>								
								<div class="form-horizontal">									
									<div class="form-group">
										<label class="control-label">Tên chương trình</label>
										<div class="controls">
											<select id="IdCategory1" name="IdCategory1" >
												<option tal:repeat="CategoryPrograme CategoryProgrameAll" tal:attributes="value CategoryPrograme/getId" >
													<span  tal:content="CategoryPrograme/getName"/>
												</option>
											</select>										
										</div>
									</div>
									<div class="form-group">
										<label class="control-label">Ngày làm</label>
										<div class="controls">
											<input id="DateWork" style="width:30%" class="form-control input-small" name="DateWork" type="text" />
										</div>
									</div>
									<div class="form-group">
										<label class="control-label">Số lượng</label>
										<div class="controls">
											<input id="NCount" name="NCount" type="text" class="form-control input-small"/>
										</div>
									</div>
									<div class="form-group">
										<label class="control-label">Nội dung</label>
										<div class="controls">
											<textarea id="ContentEdit" name="ContentEdit" type="text" class="form-control"/>
										</div>
									</div>									
								</div>
								<div class="form-group">										
										<button id="URLUpdateReward" class="btn btn-primary btn-small" value="Validate"><i class="glyphicons-download_alt"/> Lưu</button>
										<button data-dismiss="modal" class="btn btn-default btn-small"><i class="glyphicons-undo"/> Hủy</button>
									</div>
							</div>
						</div>
					</div>
										
				<div id="DialogMsgBox" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header"><h3>CẢNH BÁO</h3></div>
							<div class="modal-body">
								<p id="MsgBoxContent">Bạn có thông báo không ?</p>
							</div>
							<div class="modal-footer">					
								<button data-dismiss="modal" class="btn btn-default btn-small">Đóng</button>
							</div>
						</div>
					</div>
				</div>
		<script type="text/javascript">
		/*<![CDATA[*/		
           
			$("#RewardLoad").load("/thu-lao/reward/trang");
			$('#DateStart').datepicker({
				format: 'yyyy/mm/dd'
			})			
			$('#DateWork').datepicker({
				format: 'yyyy/mm/dd'
			})			
			var today = $.datepicker.formatDate('yy/mm/dd', new Date());
			$('#DateStart').val(today);
			
				
			
			$('#BtnAddReward').click(function(e){				
				var Data = [];
				Data[0] 	= 'null';
				Data[1] 	= $("#IdCategory").val();
				Data[2] 	= $("#IdUser").attr('alt');					
				Data[3] 	= $("#Content").val();	
				Data[4] 	= $("#Count").val();	
				Data[5] 	= $("#DateStart").val();	
				Data[6] 	= 'null';	
				Data[7] 	= '';	
				
				var URL = "/object/ins/Salarydaily";
					$.ajax({
						type: "POST",
						data: {Data:Data},
						url: URL,						
						success: function(msg){	
							$("#RewardLoad").load("/thu-lao/reward/trang");	
							$("#DialogMsgBox").modal('show');
							$("#MsgBoxContent").html('Đã thêm thành công!');	
							
							var url = "/thu-lao/reward/load";				
							$.getJSON(url, function(data){										
								$('#NTotal').html(data.NTotal); 
								$('#NTotalABC').html(data.NTotalABC); 										
							});	
						}
					});
			});	
			
			$('#URLChangeTimeButton').click(function(e){				
				var mYear 	= $("#mYear").val();
				var mMonth 	= $("#mMonth").val();				
				URL = "thu-lao/app/changetime/"+mMonth+"/"+mYear;
				$.ajax({
					type: "POST", 
					async: false,
					url: URL,
					dataType: 'json',					
					success: function(data){						
					}
				});
				location.reload(true);
			});		
			
			
		/*]]>*/
		</script>		
	</body>
</html>